<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Luce</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 20px; margin: 20px 0; border-radius: 5px; }
        .on { background-color: #ffffcc; }
        .off { background-color: #e0e0e0; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .live-indicator { color: #00ff00; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>
    <h1>Dashboard Controllo Luce <span class="live-indicator">‚óè LIVE</span></h1>
    
    <div id="status-container">
        <!-- Questo verr√† aggiornato via AJAX -->
    </div>
    
    <div id="stats-container">
        <!-- Statistiche -->
    </div>
    
    <h3>Ultimi Eventi</h3>
    <div id="events-container">
        <!-- Tabella eventi -->
    </div>

    <script>
        function updateDashboard() {
            fetch('/api/dashboard-data/')
                .then(response => response.json())
                .then(data => {
                    // Aggiorna stato
                    document.getElementById('status-container').innerHTML = `
                        <div class="status ${data.is_on ? 'on' : 'off'}">
                            <h2>Stato Attuale: ${data.is_on ? 'üí° ACCESA' : '‚ö´ SPENTA'}</h2>
                            <p>Ultimo cambio: ${data.ultimo_cambio}</p>
                        </div>
                    `;
                    
                    // Aggiorna statistiche
                    document.getElementById('stats-container').innerHTML = `
                        <h3>Statistiche</h3>
                        <p>Totale accensioni: ${data.totale_accensioni}</p>
                        <p>Totale spegnimenti: ${data.totale_spegnimenti}</p>
                    `;
                    
                    // Aggiorna eventi
                    let eventsHtml = '<table><tr><th>Stato</th><th>Data/Ora</th></tr>';
                    data.eventi.forEach(evento => {
                        eventsHtml += `
                            <tr>
                                <td>${evento.stato}</td>
                                <td>${evento.timestamp}</td>
                            </tr>
                        `;
                    });
                    eventsHtml += '</table>';
                    document.getElementById('events-container').innerHTML = eventsHtml;
                });
        }
        
        // Aggiorna ogni 2 secondi
        updateDashboard();
        setInterval(updateDashboard, 50);
    </script>
</body>
</html>